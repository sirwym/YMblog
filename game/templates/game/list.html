{% extends "base.html" %}

{% block title %}æ¸¸æˆå·¥åŠ{% endblock %}

{% block content %}
    <div class="space-y-16">
        <section>
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-4">
                <div class="flex items-center gap-3">
                    <h1 class="text-3xl font-extrabold flex items-center gap-3">
                        <span class="w-1.5 h-8 bg-primary rounded-full"></span>
                        æ¸¸æˆåˆ—è¡¨
                    </h1>
                </div>

                <div class="flex gap-2 w-full md:w-auto justify-end">
                    <div class="dropdown dropdown-end">
                        <div tabindex="0" role="button" class="btn btn-sm btn-ghost gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12" />
                            </svg>
                            {% if current_sort == 'newest' %}æœ€æ–°å‘å¸ƒ
                            {% elif current_sort == 'oldest' %}æœ€æ—©å‘å¸ƒ
                            {% elif current_sort == 'hot' %}ç‚¹èµæœ€å¤š
                            {% elif current_sort == 'cold' %}ç‚¹èµæœ€å°‘
                            {% else %}æ’åºæ–¹å¼{% endif %}
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-50" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </div>
                        <ul tabindex="0" class="dropdown-content z-1 menu p-2 shadow bg-base-100 rounded-box w-52">
                            <li><a href="?sort=newest{% if current_category %}&category={{ current_category }}{% endif %}" class="{% if current_sort == 'newest' %}active{% endif %}">æœ€æ–°å‘å¸ƒ (é»˜è®¤)</a></li>
                            <li><a href="?sort=oldest{% if current_category %}&category={{ current_category }}{% endif %}" class="{% if current_sort == 'oldest' %}active{% endif %}">æœ€æ—©å‘å¸ƒ</a></li>
                            <li><a href="?sort=hot{% if current_category %}&category={{ current_category }}{% endif %}" class="{% if current_sort == 'hot' %}active{% endif %}">ç‚¹èµæœ€å¤š</a></li>
                            <li><a href="?sort=cold{% if current_category %}&category={{ current_category }}{% endif %}" class="{% if current_sort == 'cold' %}active{% endif %}">ç‚¹èµæœ€å°‘</a></li>
                        </ul>
                    </div>

                    <div class="dropdown dropdown-end">
                        <div tabindex="0" role="button" class="btn btn-sm btn-ghost gap-1">
                            ç­›é€‰ç±»å‹ <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-50" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                        </div>
                        <ul tabindex="0" class="dropdown-content z-1 menu p-2 shadow bg-base-100 rounded-box w-52">
                            <li><a href="?category={% if current_sort %}&sort={{ current_sort }}{% endif %}" class="{% if not current_category %}active{% endif %}">å…¨éƒ¨</a></li>
                            {% for category in categories %}
                                <li>
                                    <a href="?category={{ category.slug }}{% if current_sort %}&sort={{ current_sort }}{% endif %}"
                                       class="{% if current_category == category.slug %}active{% endif %}">
                                        {{ category.name }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                {% for game in latest_games %}
                    <div class="card bg-base-100 shadow-sm border border-base-200 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group">
                        <figure class="aspect-[4/3] relative overflow-hidden bg-base-300">
                            <a href="{% url 'game:game_detail' game.slug %}" class="absolute inset-0 z-10" aria-label="æŸ¥çœ‹ {{ game.title }}"></a>

                            {% if game.cover %}
                                <img src="{{ game.cover.url }}" loading="lazy" alt="{{ game.title }}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                            {% else %}
                                <div class="flex items-center justify-center w-full h-full text-base-content/20">
                                    <span class="text-5xl">ğŸ‘¾</span>
                                </div>
                            {% endif %}

                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center backdrop-blur-[2px] pointer-events-none z-20">
                                <span class="btn btn-circle btn-primary scale-0 group-hover:scale-100 transition-transform duration-300 delay-75">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                </span>
                            </div>
                        </figure>

                        <div class="card-body p-4 gap-1 relative">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-lg leading-tight truncate group-hover:text-primary transition-colors">
                                    <a href="{% url 'game:game_detail' game.slug %}">{{ game.title }}</a>
                                </h3>
                            </div>

                            <div class="text-xs text-base-content/60 flex items-center gap-2 mb-2">
                                {% if game.category %}
                                    <span class="font-mono text-primary">{{ game.category.name }}</span>
                                {% endif %}
                                <span>Â·</span>
                                <span>{{ game.created_at|date:"M d" }}</span>
                            </div>

                            <div class="flex flex-wrap gap-1">
                                {% for tag in game.tags.all|slice:":2" %}
                                    <span class="badge badge-xs badge-ghost">#{{ tag.name }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {% if latest_games.paginator.num_pages > 1 %}
                <div class="flex justify-center mt-12">
                    <div class="join">
                        {% if latest_games.has_previous %}
                            <a href="?page={{ latest_games.previous_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="join-item btn btn-md">Â«</a>
                        {% else %}
                            <button class="join-item btn btn-md btn-disabled">Â«</button>
                        {% endif %}

                        {% for page_num in custom_page_range %}
                            {% if page_num == latest_games.paginator.ELLIPSIS %}
                                <button class="join-item btn btn-md btn-disabled">...</button>
                            {% else %}
                                <a href="?page={{ page_num }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="join-item btn btn-md {% if page_num == latest_games.number %}btn-primary btn-active{% endif %}">
                                    {{ page_num }}
                                </a>
                            {% endif %}
                        {% endfor %}

                        {% if latest_games.has_next %}
                            <a href="?page={{ latest_games.next_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_sort %}&sort={{ current_sort }}{% endif %}" class="join-item btn btn-md">Â»</a>
                        {% else %}
                            <button class="join-item btn btn-md btn-disabled">Â»</button>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </section>
    </div>
{% endblock %}